<?php
    $jqueryIcons = array('ui-icon-carat-1-n', 'ui-icon-carat-1-ne', 'ui-icon-carat-1-e', 'ui-icon-carat-1-se', 'ui-icon-carat-1-s', 'ui-icon-carat-1-sw', 'ui-icon-carat-1-w', 'ui-icon-carat-1-nw', 'ui-icon-carat-2-n-s', 'ui-icon-carat-2-e-w', 'ui-icon-triangle-1-n', 'ui-icon-triangle-1-ne', 'ui-icon-triangle-1-e', 'ui-icon-triangle-1-se', 'ui-icon-triangle-1-s', 'ui-icon-triangle-1-sw', 'ui-icon-triangle-1-w', 'ui-icon-triangle-1-nw', 'ui-icon-triangle-2-n-s', 'ui-icon-triangle-2-e-w', 'ui-icon-arrow-1-n', 'ui-icon-arrow-1-ne', 'ui-icon-arrow-1-e', 'ui-icon-arrow-1-se', 'ui-icon-arrow-1-s', 'ui-icon-arrow-1-sw', 'ui-icon-arrow-1-w', 'ui-icon-arrow-1-nw', 'ui-icon-arrow-2-n-s', 'ui-icon-arrow-2-ne-sw', 'ui-icon-arrow-2-e-w', 'ui-icon-arrow-2-se-nw', 'ui-icon-arrowstop-1-n', 'ui-icon-arrowstop-1-e', 'ui-icon-arrowstop-1-s', 'ui-icon-arrowstop-1-w', 'ui-icon-arrowthick-1-n', 'ui-icon-arrowthick-1-ne', 'ui-icon-arrowthick-1-e', 'ui-icon-arrowthick-1-se', 'ui-icon-arrowthick-1-s', 'ui-icon-arrowthick-1-sw', 'ui-icon-arrowthick-1-w', 'ui-icon-arrowthick-1-nw', 'ui-icon-arrowthick-2-n-s', 'ui-icon-arrowthick-2-ne-sw', 'ui-icon-arrowthick-2-e-w', 'ui-icon-arrowthick-2-se-nw', 'ui-icon-arrowthickstop-1-n', 'ui-icon-arrowthickstop-1-e', 'ui-icon-arrowthickstop-1-s', 'ui-icon-arrowthickstop-1-w', 'ui-icon-arrowreturnthick-1-w', 'ui-icon-arrowreturnthick-1-n', 'ui-icon-arrowreturnthick-1-e', 'ui-icon-arrowreturnthick-1-s', 'ui-icon-arrowreturn-1-w', 'ui-icon-arrowreturn-1-n', 'ui-icon-arrowreturn-1-e', 'ui-icon-arrowreturn-1-s', 'ui-icon-arrowrefresh-1-w', 'ui-icon-arrowrefresh-1-n', 'ui-icon-arrowrefresh-1-e', 'ui-icon-arrowrefresh-1-s', 'ui-icon-arrow-4', 'ui-icon-arrow-4-diag', 'ui-icon-extlink', 'ui-icon-newwin', 'ui-icon-refresh', 'ui-icon-shuffle', 'ui-icon-transfer-e-w', 'ui-icon-transferthick-e-w', 'ui-icon-folder-collapsed', 'ui-icon-folder-open', 'ui-icon-document', 'ui-icon-document-b', 'ui-icon-note', 'ui-icon-mail-closed', 'ui-icon-mail-open', 'ui-icon-suitcase', 'ui-icon-comment', 'ui-icon-person', 'ui-icon-print', 'ui-icon-trash', 'ui-icon-locked', 'ui-icon-unlocked', 'ui-icon-bookmark', 'ui-icon-tag', 'ui-icon-home', 'ui-icon-flag', 'ui-icon-calendar', 'ui-icon-cart', 'ui-icon-pencil', 'ui-icon-clock', 'ui-icon-disk', 'ui-icon-calculator', 'ui-icon-zoomin', 'ui-icon-zoomout', 'ui-icon-search', 'ui-icon-wrench', 'ui-icon-gear', 'ui-icon-heart', 'ui-icon-star', 'ui-icon-link', 'ui-icon-cancel', 'ui-icon-plus', 'ui-icon-plusthick', 'ui-icon-minus', 'ui-icon-minusthick', 'ui-icon-close', 'ui-icon-closethick', 'ui-icon-key', 'ui-icon-lightbulb', 'ui-icon-scissors', 'ui-icon-clipboard', 'ui-icon-copy', 'ui-icon-contact', 'ui-icon-image', 'ui-icon-video', 'ui-icon-script', 'ui-icon-alert', 'ui-icon-info', 'ui-icon-notice', 'ui-icon-help', 'ui-icon-check', 'ui-icon-bullet', 'ui-icon-radio-off', 'ui-icon-radio-on', 'ui-icon-pin-w', 'ui-icon-pin-s', 'ui-icon-play', 'ui-icon-pause', 'ui-icon-seek-next', 'ui-icon-seek-prev', 'ui-icon-seek-end', 'ui-icon-seek-start', 'ui-icon-seek-first', 'ui-icon-stop', 'ui-icon-eject', 'ui-icon-volume-off', 'ui-icon-volume-on', 'ui-icon-power', 'ui-icon-signal-diag', 'ui-icon-signal', 'ui-icon-battery-0', 'ui-icon-battery-1', 'ui-icon-battery-2', 'ui-icon-battery-3', 'ui-icon-circle-plus', 'ui-icon-circle-minus', 'ui-icon-circle-close', 'ui-icon-circle-triangle-e', 'ui-icon-circle-triangle-s', 'ui-icon-circle-triangle-w', 'ui-icon-circle-triangle-n', 'ui-icon-circle-arrow-e', 'ui-icon-circle-arrow-s', 'ui-icon-circle-arrow-w', 'ui-icon-circle-arrow-n', 'ui-icon-circle-zoomin', 'ui-icon-circle-zoomout', 'ui-icon-circle-check', 'ui-icon-circlesmall-plus', 'ui-icon-circlesmall-minus', 'ui-icon-circlesmall-close', 'ui-icon-squaresmall-plus', 'ui-icon-squaresmall-minus', 'ui-icon-squaresmall-close', 'ui-icon-grip-dotted-vertical', 'ui-icon-grip-dotted-horizontal', 'ui-icon-grip-solid-vertical', 'ui-icon-grip-solid-horizontal', 'ui-icon-gripsmall-diagonal-se', 'ui-icon-grip-diagonal-se');
?>
<script src="<?php echo sysConfig::getDirWsCatalog();?>ext/jQuery/external/nestedSortable/jquery.ui.nestedSortable.js"></script>
<link rel="stylesheet" href="<?php echo sysConfig::getDirWsCatalog();?>ext/jQuery/themes/smoothness/ui.selectmenu.css" type="text/css" media="screen,projection" />
<script type="text/javascript">
    var jqueryIcons = <?php echo json_encode($jqueryIcons);?>;
    $(document).ready(function (){
        $('#pprPriceFilterTable').find('ol.sortable').nestedSortable({
            disableNesting: 'no-nest',
            forcePlaceholderSize: true,
            handle: 'div',
            items: 'li',
            opacity: .6,
            placeholder: 'placeholder',
            tabSize: 25,
            tolerance: 'pointer',
            toleranceElement: '> div'
        });
        $('#pprPriceFilterTable').find('.addMainBlock').click(function () {
            var inputKey = 0;
            while($('#pprPriceFilterTable').find('ol.sortable > li[data-input_key=' + inputKey + ']').size() > 0){
                inputKey++;
            }
            $('#pprPriceFilterTable').find('ol.sortable')
                .append('<li id="menu_item_' + inputKey + '" data-input_key="' + inputKey + '">' +
                '<div><table cellpadding="2" cellspacing="0" border="0">' +
                '<tr>' +
                '<td valign="top"><span>Price Starts from (<input name="filter_start[' + inputKey + ']">)</span></td>' +
                '<td valign="top"><span>Price Ends at (<input name="filter_stop[' + inputKey + ']">)</span></td>' +
                '<td valign="top"><span class="ui-icon ui-icon-closethick menuItemDelete" tooltip="Delete Item and Children"></span></td>' +
                '</tr>' +
                '</table></div>' +
                '</li>');
        });
        $('.saveButton').click(function () {
            //$('input[name=pprPriceFilterSortable]').val($('#pprPriceFilterTable').find('ol.sortable').nestedSortable('serialize'));
            //alert($('#pprPriceFilterTable').find('ol.sortable').nestedSortable('serialize'));
        });
    });

</script>
<style>
    .placeholder {
        background-color : #cfcfcf;
    }

    .ui-nestedSortable-error {
        background : #fbe3e4;
        color      : #8a1f11;
    }

    ol {
        margin       : 0;
        padding      : 0;
        padding-left : 30px;
    }

    ol.sortable, ol.sortable ol {
        margin          : 0 0 0 25px;
        padding         : 0;
        list-style-type : none;
    }

    ol.sortable {
        margin : 2em 0;
    }

    .sortable li {
        margin  : 7px 0 0 0;
        padding : 0;
    }

    .sortable li div {
        border  : 1px solid black;
        padding : 3px;
        margin  : 0;
        cursor  : move;
    }

    li .ui-icon-closethick {
        float  : right;
        margin : .5em;
    }

    li select {
        margin-left  : .5em;
        margin-right : .5em;
    }
</style>
<?php
    $editTable = htmlBase::newElement('table')
        ->setId('pprPriceFilterTable')
        ->setCellPadding(2)
        ->setCellSpacing(0);

    $editTable->addBodyRow(array(
                                'columns' => array(
                                    array('text' => '<span class="ui-icon ui-icon-plusthick addMainBlock"></span><input type="hidden" name="pprPriceFilterSortable" value="">')
                                )
                           ));
    $content = '';
    if(isset($WidgetSettings->filters)){
        $i = 0;
        foreach($WidgetSettings->filters as $filterData){
            $content .= '<li id="menu_item_' . $i . '" data-input_key="' . $i . '">' .
                        '<div><table cellpadding="2" cellspacing="0" border="0" width="100%">' .
                        '<tr>' .
                        '<td><span>' .
                        sysLanguage::get('Start Price:') .
                        '</span></td>' .
                        '<td valign="top">' .
                        htmlBase::newElement('input')
                            ->setName('filter_start['.$i.']')
                            ->setValue($filterData->start)->draw() .
                        '</td>'.
                        '<td><span>' .
                        sysLanguage::get('Stop Price:') .
                        '</span></td>' .
                        '<td valign="top">' .
                        htmlBase::newElement('input')
                            ->setName('filter_stop['.$i.']')
                            ->setValue($filterData->stop)->draw() .
                        '</td>' .
                        '</tr>' .
                        '</table></div>' .
                        '</li>';
            $i++;
        }

    }
    $editTable->addBodyRow(array(
                                'columns' => array(
                                    array('text' => '<ol class="ui-widget sortable">' . $content . '</ol>')
                                )
                           ));

    $WidgetSettingsTable->addBodyRow(array(
                                          'columns' => array(
                                              array('colspan' => 2, 'text' => '<b>' . sysLanguage::get('PPR search filter') . '</b>')
                                          )
                                     ));


    $WidgetSettingsTable->addBodyRow(array(
                                          'columns' => array(
                                              array('colspan' => 2,'text' => '<ol class="ui-widget sortable">' . $editTable->draw() . '</ol>')
                                          )
                                     ));